 const PORT = 8000
 const express = require('express')
 const axios = require('axios')
 const cheerio = require('cheerio')
const { response } = require('express')

 //creates a new express application
 const app = express()
 
 const stores = [
    {
        name: 'Best Buy',
        address: 'https://www.bestbuy.ca/en-ca/category/ps5-console/17583383?icmp=ps5_offer_20200911_console'
    },
    {
        name: 'Shoppers Drug Mart',
        address: 'https://shop.shoppersdrugmart.ca/search?text=ps5&sort=relevance&page=0&q=ps5'

    },
    {
        name: 'Costco',
        address: 'https://www.costco.ca/playstation-5.html'
    }
 ]

 const articles =[]

 stores.forEach(store => {
    axios.get(store.address)
    .then(response => {
        const html = response.data
        console.log(html)
        const $ = cheerio.load(html)
        

        $('a:contains("playstation")', html).each(function () {
                const title = $(this).text()
                articles.push({
                    title
                })
                
        })
    })
 })

 app.get ('/', (req, res) => {
    res.json('Welcome to my Ps5 News API')
 })

 app.get('/news', (req, res) => {
    // axios.get('https://www.bestbuy.ca/en-ca/category/ps5-console/17583383?icmp=ps5_offer_20200911_console')
    // .then((response) => {
    //     const html = response.data
    //     console.log(html)
    //     const $ = cheerio.load(html)

    //     $('.productItemName_3IZ3csto', html).each(function () {
    //         const title = $(this).text()
    //         articles.push({
    //             title
    //         })
    //     })
    //     res.json(articles)
        
    // }).catch((err) => console.log(err))
    // .catch((error) => {
    //     console.log(error)
    // })
    res.json(articles)
 })

 app.listen(PORT, () => console.log(`server running on PORT ${PORT}`))